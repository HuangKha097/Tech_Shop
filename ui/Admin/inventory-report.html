<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechStore - Inventory</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- CSS BỔ SUNG --- */

        /* 1. Tabs Navigation */
        .tabs-nav {
            display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;
        }
        .tab-btn {
            padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent;
            font-size: 1.5rem; font-weight: 600; color: #718096; cursor: pointer; transition: all 0.3s;
        }
        .tab-btn.active {
            color: #2f855a; border-bottom-color: #2f855a; background-color: #f0fff4;
        }
        .tab-pane { display: none; animation: fadeIn 0.3s ease; }
        .tab-pane.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 2. Warning Alert */
        .filter-row-container {
            display: flex; gap: 20px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;
        }
        .alert-warning {
            flex: 1; background-color: #fffaf0; border: 1px solid #fbd38d; color: #c05621;
            padding: 12px 20px; border-radius: 8px; display: flex; align-items: center;
            font-size: 1.4rem; min-width: 300px;
        }

        /* 3. Controls */
        .filter-controls { display: flex; gap: 10px; align-items: center; }
        .custom-input {
            padding: 10px 15px; border: 1px solid #e2e8f0; border-radius: 6px; outline: none; font-size: 1.4rem;
        }
        .btn-search {
            background-color: var(--primary-color); color: white; border: none; padding: 10px 15px;
            border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .btn-search:hover { background-color: #276749; transform: translateY(-2px); }

        /* 4. Table Styling */
        .product-img-small {
            width: 50px; height: 50px; object-fit: cover; border-radius: 6px; border: 1px solid #e2e8f0;
        }
        .warning-row { background-color: #fffaf0 !important; }

        /* Badges */
        .badge-custom {
            padding: 6px 12px; border-radius: 20px; font-size: 1.2rem; font-weight: 600;
            display: inline-flex; align-items: center; gap: 5px;
        }
        .badge-stock { background-color: #c6f6d5; color: #22543d; }
        .badge-low {
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            color: #000; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Stats Summary */
        .inventory-stats-bar {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px;
        }
        .stat-box {
            background: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;
        }
        .stat-num { font-size: 2.4rem; font-weight: 700; color: #2d3748; }
        .stat-label { font-size: 1.3rem; color: #718096; margin-top: 5px; }
        .stat-num.warning { color: #dd6b20; }

        /* Loading Spinner */
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
<div class="app-container">
    <nav class="sidebar">
        <div style="width: 100%; display:flex; justify-content: center" class="sidebar-header">
            <img style="width: 150px;" src="../../ui/User/assets/images/2.png" alt="logo">
        </div>
        <ul class="nav-list">
            <li class="nav-item"><a href="index.html"><i class="fa-solid fa-table-cells-large"></i><span>Dashboard</span></a></li>
            <li class="nav-item"><a href="products.html"><i class="fa-solid fa-box-archive"></i><span>Products</span></a></li>
            <li class="nav-item"><a href="imports.html"><i class="fa-solid fa-file-import"></i><span>Imports</span></a></li>
            <li class="nav-item"><a href="price-management.html"><i class="fa-solid fa-tags"></i><span>Price & Profit</span></a></li>
            <li class="nav-item"><a href="inventory-report.html" class="active"><i class="fa-solid fa-warehouse"></i><span>Inventory</span></a></li>
            <li class="nav-item"><a href="categories.html"><i class="fa-solid fa-folder-tree"></i><span>Categories</span></a></li>
            <li class="nav-item"><a href="orders.html"><i class="fa-solid fa-cart-shopping"></i><span>Orders</span></a></li>
            <li class="nav-item"><a href="customers.html"><i class="fa-solid fa-users"></i><span>Customers</span></a></li>
            <li class="nav-item"><a href="reports.html"><i class="fa-solid fa-chart-line"></i><span>Sales Reports</span></a></li>
        </ul>
        <div class="sidebar-footer">
            <ul class="nav-list"><li class="nav-item"><a href="./settings.html"><i class="fa-solid fa-gear"></i><span>Settings</span></a></li></ul>
        </div>
    </nav>

    <main class="main-content">
        <header class="app-header">
            <form action="search-results.html" method="GET" class="header-search">
                <i class="fa-solid fa-search"></i>
                <input type="text" name="query" placeholder="Search products, orders, customers...">
            </form>
            <div class="header-right">
                <button class="icon-btn"><i class="fa-regular fa-bell"></i></button>
                <div class="profile-menu" id="profile-menu-toggle">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQbN9kird_uBOxIp7D8wPDFheGHqHYkba_FDw&s" alt="Admin Avatar">
                    <i class="fa-solid fa-chevron-down"></i>
                </div>
                <div class="profile-dropdown" id="profile-dropdown">
                    <div class="dropdown-header"><span>Admin</span><small>admin@tech.com</small></div>
                    <ul class="dropdown-list">
                        <li class="dropdown-item"><a href="./settings.html"><i class="fa-solid fa-gear"></i><span>Setting</span></a></li>
                    </ul>
                    <div class="dropdown-footer">
                        <li class="dropdown-item"><a href="./login.html"><i class="fa-solid fa-arrow-right-from-bracket"></i><span>Logout</span></a></li>
                    </div>
                </div>
            </div>
        </header>

        <div class="page-content">
            <div class="page-header">
                <div>
                    <h1>Inventory Management</h1>
                    <p>Track stock levels and history</p>
                </div>
            </div>

            <div class="tabs-nav">
                <button class="tab-btn active" onclick="openTab('current')"><i class="fa-solid fa-box me-2"></i> Current Inventory</button>
                <button class="tab-btn" onclick="openTab('history')"><i class="fa-solid fa-clock-rotate-left me-2"></i> Stock History</button>
            </div>

            <div id="current" class="tab-pane active">

                <div class="inventory-stats-bar">
                    <div class="stat-box">
                        <div class="stat-num" id="totalStock">0</div>
                        <div class="stat-label">Total Units</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-num" id="totalProducts">0</div>
                        <div class="stat-label">Products</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-num warning" id="lowStockCount">0</div>
                        <div class="stat-label">Low Stock</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-num" id="inStockCount" style="color: #2f855a;">0</div>
                        <div class="stat-label">In Stock</div>
                    </div>
                </div>

                <div class="filter-row-container">
                    <div class="alert-warning">
                        <i class="fa-solid fa-triangle-exclamation" style="margin-right: 10px;"></i>
                        <span>Warning: <strong><span id="warningCountText">0</span> products</strong> are running low on stock.</span>
                    </div>

                    <div class="filter-controls">
                        <input type="date" class="custom-input" value="2025-11-24">

                        <input type="text" id="searchInventoryInput" class="custom-input" placeholder="Search by name or SKU..." style="width: 250px;">
                        <button class="btn-search" id="searchInventoryBtn"><i class="fa-solid fa-magnifying-glass"></i></button>

                        <select class="custom-input" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="In Stock">In Stock</option>
                            <option value="Low Stock">Low Stock</option>
                        </select>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Image</th>
                            <th>Product Name</th>
                            <th>Quantity</th>
                            <th>Unit</th>
                            <th>Price ($)</th>
                            <th>Last Import</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span>Showing 1 to 5 of 5 results</span>
                        <div class="pagination-controls">
                            <button disabled><i class="fa-solid fa-chevron-left"></i></button>
                            <button class="active">1</button>
                            <button>2</button>
                            <button><i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="history" class="tab-pane">
                <div class="filter-row-container">
                    <div class="filter-controls" style="flex: 1;">
                        <label style="font-weight: 600; color: #718096;">From:</label>
                        <input type="date" class="custom-input" value="2025-11-01">
                        <label style="font-weight: 600; color: #718096; margin-left: 10px;">To:</label>
                        <input type="date" class="custom-input" value="2025-11-24">

                        <button class="btn-search" id="filterHistoryDateBtn" style="background-color: #4a5568;"><i class="fa-solid fa-filter"></i> Filter</button>
                    </div>
                    <div class="filter-controls">
                        <input type="text" id="searchHistoryInput" class="custom-input" placeholder="Search history..." style="width: 300px;">
                        <button class="btn-search" id="searchHistoryBtn"><i class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Image</th>
                            <th>Product Name</th>
                            <th>Opening</th>
                            <th style="color: #2f855a;">Import (+)</th>
                            <th style="color: #c53030;">Export (-)</th>
                            <th style="color: #3182ce;">Closing</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>
</div>

<div class="toast" id="success-toast">
    <i class="fa-solid fa-check-circle"></i>
    <span>Action completed!</span>
</div>

<script src="assets/js/main.js"></script>

<script>
    // --- DỮ LIỆU ---
    const inventory = [
        { code: 'TEC001', name: 'iPhone 15 Pro Max', quantity: 43, unit: 'Unit', price: 1199, date: '2025-10-21', status: 'In Stock', image: 'https://images.unsplash.com/photo-1695048132832-b41495f12eb4?w=100' },
        { code: 'TEC002', name: 'Samsung S24 Ultra', quantity: 3, unit: 'Unit', price: 1299, date: '2025-10-22', status: 'Low Stock', image: 'https://images.unsplash.com/photo-1705585174953-9b2aa8afc174?w=100' },
        { code: 'TEC003', name: 'MacBook Air M2', quantity: 10, unit: 'Unit', price: 1099, date: '2025-11-01', status: 'In Stock', image: 'https://images.unsplash.com/photo-1659135890064-d57187f0946c?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
        { code: 'TEC004', name: 'AirPods Pro 2', quantity: 72, unit: 'Box', price: 249, date: '2025-10-25', status: 'In Stock', image: 'https://images.unsplash.com/photo-1593442607435-e4e34991b210?w=100' },
        { code: 'TEC005', name: 'Sony WH-1000XM5', quantity: 2, unit: 'Unit', price: 349, date: '2025-10-29', status: 'Low Stock', image: 'https://images.unsplash.com/photo-1755719401908-8612266b10c2?q=80&w=688&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
    ];

    const history = [
        { code: 'TEC001', name: 'iPhone 15 Pro Max', start: 40, in: 15, out: 12, end: 43, status: 'In Stock', image: 'https://images.unsplash.com/photo-1695048132832-b41495f12eb4?w=100' },
        { code: 'TEC002', name: 'Samsung S24 Ultra', start: 5, in: 6, out: 8, end: 3, status: 'Low Stock', image: 'https://images.unsplash.com/photo-1705585174953-9b2aa8afc174?w=100' },
        { code: 'TEC003', name: 'MacBook Air M2', start: 8, in: 5, out: 3, end: 10, status: 'In Stock', image: 'https://images.unsplash.com/photo-1659135890064-d57187f0946c?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
        { code: 'TEC004', name: 'AirPods Pro 2', start: 65, in: 20, out: 13, end: 72, status: 'In Stock', image: 'https://images.unsplash.com/photo-1593442607435-e4e34991b210?w=100' },
        { code: 'TEC005', name: 'Sony WH-1000XM5', start: 5, in: 0, out: 3, end: 2, status: 'Low Stock', image: 'https://images.unsplash.com/photo-1755719401908-8612266b10c2?q=80&w=688&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
    ];

    // --- HELPER FUNCTIONS ---
    function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
    }

    function getRowClass(qty) {
        return qty <= 5 ? 'warning-row' : '';
    }

    function getStatusBadge(qty) {
        if (qty <= 5) {
            return `<span class="badge-custom badge-low"><i class="fa-solid fa-triangle-exclamation"></i> Low Stock</span>`;
        }
        return `<span class="badge-custom badge-stock"><i class="fa-solid fa-check-circle"></i> In Stock</span>`;
    }

    function showToast(message) {
        const toast = document.getElementById("success-toast");
        const toastText = toast.querySelector("span");
        toastText.innerText = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
    }

    // --- RENDER FUNCTIONS ---
    function renderInventory(data = inventory) {
        const tbody = document.getElementById('inventoryTableBody');
        tbody.innerHTML = '';

        let totalStock = 0;
        let lowStock = 0;

        // Tính toán lại stats
        inventory.forEach(item => {
            totalStock += item.quantity;
            if(item.quantity <= 5) lowStock++;
        });

        // Update Stats UI
        document.getElementById('totalStock').textContent = totalStock;
        document.getElementById('totalProducts').textContent = inventory.length;
        document.getElementById('lowStockCount').textContent = lowStock;
        document.getElementById('warningCountText').textContent = lowStock;
        document.getElementById('inStockCount').textContent = inventory.length - lowStock;

        // Render Table
        data.forEach(item => {
            const row = document.createElement('tr');
            row.className = getRowClass(item.quantity);
            row.innerHTML = `
                <td><strong>${item.code}</strong></td>
                <td><img src="${item.image}" class="product-img-small" alt="img"></td>
                <td>${item.name}</td>
                <td style="font-weight: 700; font-size: 1.5rem;">${item.quantity}</td>
                <td>${item.unit}</td>
                <td>${formatCurrency(item.price)}</td>
                <td>${item.date}</td>
                <td>${getStatusBadge(item.quantity)}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function renderHistory(data = history) {
        const tbody = document.getElementById('historyTableBody');
        tbody.innerHTML = '';

        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${item.code}</strong></td>
                <td><img src="${item.image}" class="product-img-small" alt="img"></td>
                <td>${item.name}</td>
                <td>${item.start}</td>
                <td style="color: #2f855a; font-weight: 700;">+${item.in}</td>
                <td style="color: #c53030; font-weight: 700;">-${item.out}</td>
                <td style="font-weight: 700; font-size: 1.5rem;">${item.end}</td>
                <td>${getStatusBadge(item.end)}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // --- FAKE LOADING FUNCTION ---
    // Hàm này sẽ hiển thị spinner rồi trả về dữ liệu GỐC (không lọc)
    function setupSearchButton(btnId, inputId, renderFunc, originalData, tableBodyId) {
        const btn = document.getElementById(btnId);
        const tbody = document.getElementById(tableBodyId);

        btn.addEventListener('click', () => {
            // 1. Hiển thị Loading Spinner
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:40px; color: #718096;"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><br><span style="margin-top:10px; display:block">Searching...</span></td></tr>';

            // 2. Delay giả lập rồi trả về dữ liệu ban đầu (KHÔNG LỌC)
            setTimeout(() => {
                renderFunc(originalData);
                showToast("Data reloaded!");
            }, 800);
        });
    }

    // --- TAB LOGIC ---
    window.openTab = function(tabName) {
        document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');

        const btns = document.querySelectorAll('.tab-btn');
        if(tabName === 'current') btns[0].classList.add('active');
        else btns[1].classList.add('active');
    }

    // --- INITIALIZE ---
    document.addEventListener("DOMContentLoaded", function () {
        // 1. Render data ban đầu
        renderInventory();
        renderHistory();

        // 2. Cài đặt nút tìm kiếm (Chỉ load giả)
        setupSearchButton('searchInventoryBtn', 'searchInventoryInput', renderInventory, inventory, 'inventoryTableBody');
        setupSearchButton('searchHistoryBtn', 'searchHistoryInput', renderHistory, history, 'historyTableBody');

        // 3. Cài đặt nút Lọc (Chỉ load giả)
        document.getElementById('filterHistoryDateBtn').addEventListener('click', () => {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:40px; color: #718096;"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><br>Filtering...</td></tr>';
            setTimeout(() => {
                renderHistory(history);
                showToast("Filter applied!");
            }, 800);
        });
    });
</script>

</body>
</html>